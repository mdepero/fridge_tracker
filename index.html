<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>The HTML5</title>
  <meta name="description" content="The HTML5 Herald">
  <meta name="author" content="SitePoint">
  
  <style>
    .center {
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
    h1, h2 { text-align: center; }
  </style>

  <!--[if lt IE 9]>
  <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <script src="https://www.gstatic.com/firebasejs/7.17.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.17.1/firebase-firestore.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>

<body>
  <h1>1400 College Ave</h1>
  <h2>Fridge Temperature Reporting
  <canvas id="myChart" width="600" height="400" class="center"></canvas>

  <script>
    var config = {
      apiKey: "AIzaSyA0DYkwkEGeAkT2980_wUj5hmUjh1p-QiQ",
      authDomain: "fridge-tracker-284707.firebaseapp.com",
      databaseURL: "https://fridge-tracker-284707.firebaseio.com",
      projectId: "fridge-tracker-284707",
      storageBucket: "fridge-tracker-284707.appspot.com",
      messagingSenderId: "129417103404",
      appId: "1:129417103404:web:31fc7f124bca97d143a989"
    };
    firebase.initializeApp(config);
    var db = firebase.firestore();
    var chart_data = {
      labels: [],
      datasets: [{
        label: 'fridge_temp'
        data: []
      }]
    };
    
    var ctx = document.getElementById('myChart');
    
    var myLineChart = new Chart(ctx, {
        type: 'line',
        data: chart_data
    });

    $(document).ready(function(){
      db.collection("readings")
        .get()
        .then(function(querySnapshot) {
            querySnapshot.forEach(function(doc, index, array) {
                myLineChart.data.labels.push(new Date(doc.data().time_iso));
                myLineChart.data.datasets[0].data.push(doc.data().reading);
                myLineChart.update();
            });
        })
        .catch(function(error) {
            console.log("Error getting documents: ", error);
        });
    });
  </script>
</body>
</html>
